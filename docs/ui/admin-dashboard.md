# 管理者ダッシュボードUI設計書

## 概要

管理者ダッシュボードは美容サロン全体の運営状況を一目で把握するための画面です。本設計書では、ダッシュボードのUI構成、コンポーネント設計、状態管理、データフローについて詳細に説明します。

## UI構成

### 全体レイアウト

![ダッシュボードレイアウト](../media/dashboard-layout.png)

管理者ダッシュボードは以下の主要セクションで構成されています：

1. **ヘッダー**: タイトルと現在の日付
2. **統計カード**: 基本情報の概要表示
3. **トークン使用状況**: GPT-4oトークン使用状況のグラフと概要
4. **未担当予約**: 本日の未担当予約一覧表示

### カラーパレット

- **プライマリカラー**: `#ec407a`（ピンク）
- **セカンダリカラー**: `#c2185b`（ダークピンク）
- **アクセントカラー**: `#26a69a`（ティール）
- **警告カラー**: `#ff9800`（オレンジ）
- **エラーカラー**: `#f44336`（レッド）
- **バックグラウンドカラー**: `#f5f5f5`（ライトグレー）
- **カードバックグラウンド**: `#ffffff`（ホワイト）
- **テキストプライマリ**: `#424242`（ダークグレー）
- **テキストセカンダリ**: `#757575`（ミディアムグレー）

### タイポグラフィ

- **ヘッドライン**: Roboto, 24px, 500 weight
- **サブヘッド**: Roboto, 18px, 500 weight
- **カードタイトル**: Roboto, 16px, 500 weight
- **カード値**: Roboto, 32px, 600 weight
- **通常テキスト**: Roboto, 14px, 400 weight
- **小さいテキスト**: Roboto, 12px, 400 weight

## コンポーネント詳細

### 1. ダッシュボードヘッダー

```
+----------------------------------------------------------------------------------+
|  ダッシュボード                               2025年4月26日 (土)                    |
+----------------------------------------------------------------------------------+
```

- **機能**: ページタイトルと現在の日付を表示
- **状態**: なし（静的コンポーネント）

### 2. 統計カード

```
+--------------------+  +--------------------+  +--------------------+  +--------------------+
|                    |  |                    |  |                    |  |                    |
| 本日の予約数        |  | 全クライアント数    |  | スタイリスト数      |  | 今週の施術完了数    |
| 15                 |  | 485                |  | 8                  |  | 62                 |
|                    |  |                    |  |                    |  |                    |
+--------------------+  +--------------------+  +--------------------+  +--------------------+
```

- **コンポーネント名**: `DashboardStats`
- **プロパティ**:
  - `stats`: 統計データオブジェクト
- **状態**: なし（親コンポーネントから受け取ったデータを表示するのみ）
- **レスポンシブ対応**: 画面幅に応じてカードをグリッドレイアウトで調整（4列→2列→1列）

### 3. トークン使用状況

```
+-------------------------------------------+  +------------------------------+
|                                           |  |                              |
|  GPT-4oトークン使用状況      [期間選択]     |  |  月間使用量サマリー           |
|                                           |  |                              |
|                                           |  |  使用量: 63,240 / 100,000    |
|                                           |  |  [==========63.24%=====]    |
|                                           |  |  残り: 36,760 トークン        |
|         [グラフ表示エリア]                  |  |                              |
|                                           |  |  プラン上限: 100,000トークン/月 |
|                                           |  |  更新日: 2025/05/01          |
|                                           |  |                              |
|                                           |  |  [プランアップグレード]        |
|                                           |  |                              |
+-------------------------------------------+  +------------------------------+
```

- **コンポーネント名**: `TokenUsageSection`
- **サブコンポーネント**:
  - `TokenUsageChart`: トークン使用量のグラフ表示
  - `TokenUsageSummary`: 使用量サマリー表示
- **プロパティ**:
  - `tokenUsage`: トークン使用状況データ
- **状態**:
  - 選択された期間（今月/先月/過去3ヶ月）
- **インタラクション**:
  - 期間選択ドロップダウン操作
  - プランアップグレードボタン（Owner権限のみ表示）
- **レスポンシブ対応**: 横並びレイアウト→縦積みレイアウトへの切り替え

### 4. 未担当予約

```
+----------------------------------------------------------------------------+
|  本日の未担当予約 [3]                                 [すべて割り当て]       |
+----------------------------------------------------------------------------+
|                                                                            |
|  □ 佐藤 美咲 様 - カット・カラー                                      火     |
|    11:00 - 12:30                                                          |
|                                                                            |
|  □ 田中 裕子 様 - パーマ・トリートメント                               土     |
|    13:30 - 15:30                                                          |
|                                                                            |
|  □ 山本 健太 様 - メンズカット                                       金     |
|    16:00 - 16:45                                                          |
|                                                                            |
+----------------------------------------------------------------------------+
```

- **コンポーネント名**: `UnassignedAppointments`
- **サブコンポーネント**:
  - `AppointmentCard`: 各予約情報のカード表示
  - `AssignmentModal`: スタイリスト割り当てモーダル
- **プロパティ**:
  - `appointments`: 未担当予約リスト
  - `onAssignStylist`: スタイリスト割り当て処理関数
- **状態**:
  - 選択された予約ID
  - モーダル表示状態
  - 選択されたスタイリストID
- **インタラクション**:
  - 予約カードのクリックでスタイリスト割り当てモーダル表示
  - チェックボックス操作による予約選択
  - 「すべて割り当て」ボタンによる一括処理
- **視覚的フィードバック**:
  - 五行属性に応じたカラータグ（水:青、木:緑、火:赤、土:オレンジ、金:グレー）

## 状態管理

### コンポーネント状態構造

```
Dashboard (Container)
├── loading: boolean
├── error: Error | null
├── stats: DashboardStats | null
├── tokenUsage: TokenUsageStats | null
├── unassignedAppointments: UnassignedAppointment[]
├── selectedPeriod: 'current_month' | 'last_month' | 'last_3_months'
└── selectedAppointmentId: string | null
```

### データロードフロー

1. コンポーネントマウント時にデータ取得開始
2. ローディング状態を表示（CircularProgress）
3. 並列で各APIエンドポイントを呼び出し
4. データ取得成功時に各状態を更新
5. エラー発生時にエラー状態を更新

### エラーハンドリング

- APIエラー発生時のフォールバックUI表示
- 再試行機能の提供
- 継続的なデータ取得のためのエラー隔離（部分的なデータ表示）

## データフロー

### APIリクエスト・レスポンスフロー

```
+----------------+    +-----------------+    +----------------+
|                |    |                 |    |                |
| React          |    | API Service     |    | Backend API    |
| Component      |----| (axios)         |----| (Express)      |
|                |    |                 |    |                |
+----------------+    +-----------------+    +----------------+
         |                    |                     |
         v                    v                     v
 +----------------+    +-----------------+    +----------------+
 |                |    |                 |    |                |
 | State Update   |<---| Response        |<---| MongoDB        |
 | (React hooks)  |    | Processing      |    | Aggregation    |
 |                |    |                 |    |                |
 +----------------+    +-----------------+    +----------------+
```

### イベントフロー（スタイリスト割り当て）

1. ユーザーが予約カードをクリック
2. 割り当てモーダルが表示され、スタイリスト一覧を表示
3. ユーザーがスタイリストを選択して「割り当て」ボタンをクリック
4. API呼び出しでバックエンドに割り当て情報を送信
5. 成功応答を受けて未担当予約リストを更新（割り当て済み予約を除外）
6. モーダルを閉じて成功メッセージを表示

## レスポンシブデザイン

### ブレークポイント

- **Extra Small**: <600px（モバイル）
- **Small**: 600px - 960px（タブレット縦向き）
- **Medium**: 960px - 1280px（タブレット横向き）
- **Large**: 1280px - 1920px（デスクトップ）
- **Extra Large**: >1920px（大画面）

### 各ブレークポイントでのレイアウト調整

#### Extra Small（モバイル）
- 統計カード: 1列表示
- トークン使用状況: グラフとサマリーを縦に配置
- 未担当予約: カード型UI、スワイプでアクション

#### Small（タブレット縦向き）
- 統計カード: 2列表示
- トークン使用状況: グラフとサマリーを縦に配置
- 未担当予約: リスト表示、タップでアクション

#### Medium以上（タブレット横向き以上）
- 統計カード: 4列表示
- トークン使用状況: グラフ（2/3幅）とサマリー（1/3幅）を横に配置
- 未担当予約: リスト表示、ホバーでアクション表示

## アクセシビリティ対応

1. **キーボードナビゲーション**
   - すべてのインタラクティブ要素にはフォーカス順序を設定
   - ボタンやフォーム要素にキーボードアクセス可能

2. **スクリーンリーダー対応**
   - チャートには適切な`aria-label`属性を設定
   - アイコンボタンには説明的なラベルを提供

3. **色のコントラスト**
   - テキストと背景のコントラスト比を確保（WCAG 2.1 AA基準以上）
   - 色だけに依存しない情報伝達（テキストラベルの併用）

## インタラクションデザイン

### ホバー状態

- カード: わずかな影の増加
- ボタン: 背景色の明度変更
- チェックボックス: アウトラインの強調

### アクティブ状態

- ボタン: 押し込み効果（内側シャドウ）
- 選択項目: 背景色変更と左ボーダー強調

### アニメーション

- グラフ: データ表示時のイーズイン
- カード: 読み込み時のフェードイン
- エラー/警告: 軽微な振動効果

## アイコン・イメージ使用

- Material Iconsを使用
- 主要アイコン:
  - event: 予約関連
  - people: クライアント関連
  - content_cut: スタイリスト関連
  - check_circle: 完了した施術
  - warning: 警告状態（トークン使用量が閾値超過時）

## テスト計画

### ユーザビリティテスト

- 管理者/オーナーロールを持つユーザーによるテスト
- 主要タスク:
  1. ダッシュボードからサロン状況の概要把握
  2. トークン使用状況の確認と期間切り替え
  3. 未担当予約へのスタイリスト割り当て

### ブラウザ・デバイステスト

- 主要ブラウザ: Chrome, Safari, Firefox, Edge
- デバイス: iPhone, iPad, Android端末, PCブラウザ

## 実装の優先順位

1. 基本統計情報表示（必須）
2. トークン使用状況グラフ（高）
3. 未担当予約管理（中）
4. レスポンシブ対応（中）
5. アクセシビリティ対応（低）