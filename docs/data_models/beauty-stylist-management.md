# 「スタイリスト管理」データモデル分析

## 概要

美姫命アプリのスタイリスト管理機能に必要なデータモデルと関連性の定義です。既存のデータ構造を最大限に活用しつつ、美容サロン向けの拡張を最小限に実装するための設計を行います。

## 基本方針

1. **既存モデルの活用**: 
   - 既存の`User`モデルをスタイリスト情報にも使用
   - 役割識別用の`role`フィールドに「Admin」「User」の値を設定
   - 管理者（Admin）がサロンオーナーとして機能し、スタイリスト（User）を管理

2. **最小限の拡張**:
   - 既存の`jobTitle`フィールドを役職情報（シニアスタイリスト等）に活用
   - プロフィール画像用に`profileImage`フィールド（任意）を追加
   - 管理者とスタイリストの関連付けには既存の関連フィールド（`createdBy`等）を活用

3. **サロン管理の段階的アプローチ**:
   - 初期段階では`Organization`モデルの直接操作を避け、ユーザー間の関連性を活用
   - 将来的に必要に応じてサロン管理機能を拡張

## データモデル

### User（スタイリスト/管理者）モデル拡張

既存の`User`モデルを活用し、以下のフィールドを重点的に使用または追加します：

```typescript
// 既存のUserモデルへの拡張
const userSchema = new Schema({
  // 既存の主要フィールド（そのまま活用）
  email: { type: String, required: true, unique: true },
  password: { type: String, required: true },
  displayName: { type: String, required: true },
  role: { type: String, enum: ['SuperAdmin', 'Admin', 'User'], default: 'User' },
  
  // 美姫命アプリで特に活用するフィールド
  jobTitle: String,  // 役職（自由入力） - シニアスタイリスト等
  
  // 新規追加フィールド
  profileImage: { type: String, required: false },  // プロフィール画像URL（任意）
  
  // 管理者-スタイリスト関連付け（既存フィールドを活用）
  createdBy: { type: Schema.Types.ObjectId, ref: 'User' },
  
  // 既存の四柱推命関連フィールド（そのまま活用）
  birthDate: String,
  birthTime: String,
  birthPlace: String,
  gender: String,
  elementAttribute: String,
  fourPillars: {},
  // その他の四柱推命関連フィールド
});
```

### データの関連性

1. **管理者とスタイリストの関係**:
   - 管理者（Admin）が複数のスタイリスト（User）を管理
   - スタイリストの`createdBy`フィールドに管理者のIDを格納
   - または既存の権限システムを活用して、同一組織内のユーザーを関連付け

2. **四柱推命情報の関連**:
   - スタイリストの基本プロフィール情報と四柱推命情報は同一の`User`モデル内に統合
   - 四柱推命情報の有無は`birthDate`、`birthTime`、`birthPlace`フィールドの存在で判定

### データフロー

1. **管理者登録時**:
   - `role`を'Admin'に設定
   - 管理者権限を付与

2. **スタイリスト登録時**:
   - `role`を'User'に設定
   - `createdBy`フィールドに管理者IDを関連付け
   - 役職情報を`jobTitle`フィールドに格納
   - プロフィール画像がある場合は`profileImage`フィールドに格納

3. **四柱推命情報登録時**:
   - 既存の四柱推命関連APIを使用して情報を更新
   - スタイリストの`User`モデル内に四柱推命情報を直接格納

## エンティティ間の関係図

```
┌────────────────┐           ┌────────────────┐
│                │           │                │
│    管理者      │◄─────────┐│   スタイリスト  │
│   (Admin)      │           ││    (User)      │
│                │    createdBy    │          │
└────────────────┘           │                │
                             └────────────────┘
                                     │
                                     │
                                     ▼
                             ┌────────────────┐
                             │                │
                             │  四柱推命情報   │
                             │ (User内に統合)  │
                             │                │
                             └────────────────┘
```

## 今後の拡張方針

1. **Stage 1**: 現在の実装
   - 管理者とスタイリストの基本的な関連付け
   - 四柱推命情報の連携
   - 役職と基本プロフィール情報の管理

2. **Stage 2**: 将来の拡張可能性
   - サロン（Organization）モデルの活用
   - クライアントとの予約・マッチング機能
   - サロン単位でのより高度な管理機能

## 注意事項

- データ整合性を保つため、スタイリスト削除時には関連データの扱いを慎重に検討する必要があります
- パスワード管理や権限変更は既存システムのセキュリティ機能を活用します
- 役職情報は自由入力とし、サロンごとに柔軟に設定できるようにします