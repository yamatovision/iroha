# SuperAdmin管理サイト要件定義書

## 1. 概要

本文書は美姫命システムにおけるSuperAdmin管理サイトの要件を定義するものである。SuperAdmin管理サイトは、美姫命サービス全体を統括し、複数のサロン（組織）を管理するためのシステム管理者向けインターフェースである。

## 2. 目的と役割

### 2.1 目的

SuperAdmin管理サイトは以下の目的で開発される：

1. 美姫命サービス全体の統合管理
2. 複数サロン（組織）の一元管理
3. サブスクリプションと課金管理
4. システム健全性の監視とメンテナンス
5. ユーザーサポート機能の提供

### 2.2 SuperAdminの役割と範囲

SuperAdminは美姫命サービスを提供する運営会社の管理者であり、以下の権限と責任を持つ：

1. 組織（サロン）の作成、管理、削除
2. サロン管理者（Admin）の初期設定と緊急時のリセット
3. サブスクリプションプランの管理と適用
4. システム全体の設定と監視
5. 緊急時の問題解決とデータアクセス

## 3. ユーザー層とアクセス権限

### 3.1 主要ユーザー

- システム管理者（運営会社の技術責任者）
- カスタマーサクセス担当者（顧客サポート）
- サービス運営責任者

### 3.2 アクセス権限階層

SuperAdmin権限内でも複数レベルの権限階層を設ける：

1. **マスターSuperAdmin**：全機能へのフルアクセス、特権操作可能
2. **運用SuperAdmin**：日常的な運用管理、設定変更が可能だが一部の特権操作は不可
3. **サポートSuperAdmin**：閲覧権限とサポート機能のみ利用可能、顧客データへの変更権限は限定的

## 4. 機能要件

### 4.1 ダッシュボード機能（モックアップ: beauty-superadmin-dashboard.html）
<!-- 主に組織全体の概況把握に特化させる -->

1. **システム概況**
   - 全サロン数と状態（アクティブ/非アクティブ/トライアル）
   - 全ユーザー数（管理者/スタイリスト別）
   - 全クライアント数
   - DAU/MAU（日次/月次アクティブユーザー）

2. **利用統計**
   - サービス利用状況のグラフ表示（時系列）
   - 機能別の利用率
   - 予約数や運勢表示数などのアクティビティ指標

3. **アラート情報**
   - システムエラーや異常の通知
   - パフォーマンス低下の警告
   - サポートチケットの状況

### 4.2 サロン管理機能（モックアップ: beauty-superadmin-organizations.html）
<!-- システムの中核機能：組織の箱管理と初期管理者設定を統合 -->

1. **サロン一覧**
   - サロン検索（名前、地域、プランなど）
   - サロン一覧表示と詳細情報
   - 状態によるフィルタリング

2. **サロン詳細管理**
   - サロン基本情報の閲覧・編集
   - 管理者・スタイリストの一覧
   - クライアント数や利用状況の確認
   - カレンダー連携状況の確認

3. **サロン作成・編集**
   - 新規サロン登録フロー
   - サロン情報の編集
   - サロンアカウントの有効化/無効化
   - サロンデータのエクスポート（監査用）

### 4.3 組織の初期管理者設定機能（モックアップ: beauty-superadmin-organizations.html に統合）

1. **組織作成時のオーナー設定**
   - 組織作成プロセスの一部として初期オーナー（Owner権限）の設定
   - オーナーの基本情報（名前、メールアドレス、連絡先）の登録
   - 自動招待メール送信機能
   - オーナー権限の自動付与（role: 'Owner'）

2. **緊急時のオーナー/管理者リセット**
   - 組織オーナーがアクセスできない場合の緊急対応
   - オーナーアカウントのパスワードリセット
   - 新規オーナーの緊急指定（既存オーナーがいない場合）
   - 権限変更の緊急処理（User → Admin、Admin → Owner）
   
3. **監査機能**
   - オーナー/管理者変更履歴の記録
   - 権限変更操作のログ記録
   - 緊急操作のログ記録
   - 組織管理者アクション履歴の表示（概要のみ）

### 4.4 サブスクリプション管理機能（モックアップ: beauty-superadmin-plans.html）
<!-- サブスクリプション・プラン設定は組織管理の主要コンポーネント -->

1. **プラン管理**
   - サブスクリプションプランの設定・編集
   - 料金設定と機能制限の管理
   - 特別プランの作成（カスタムプラン）

2. **契約管理**
   - サロンごとの契約状況確認
   - プラン変更処理
   - トライアル設定と管理
   - 支払い状況の確認

3. **請求管理**
   - 請求書発行状況の確認
   - 支払い状況のトラッキング
   - 未払い対応と自動通知設定

### 4.5 監視機能

1. **パフォーマンス監視**
   - システムリソース使用状況（CPU、メモリ、ストレージ）
   - レスポンスタイムと可用性指標
   - 潜在的なボトルネックの特定

2. **バッチ処理管理**
   - 日次運勢生成など定期バッチの実行状況確認
   - バッチ処理の手動実行機能
   - スケジュール調整機能

### 4.6 サポート機能（モックアップ: beauty-superadmin-support.html）

1. **サポートチケット管理**
   - サポート依頼の一覧と詳細表示
   - チケットの割り当てと状態管理
   - 解決履歴の記録

2. **リモートサポート**
   - サロン管理者の許可を得た上での閲覧モード
   - サポート目的の一時的権限昇格機能
   - サポート操作のログ記録

3. **お知らせ管理**
   - システム全体へのお知らせ作成
   - サロン別のお知らせ設定
   - お知らせの表示期間設定


## 5. 非機能要件

### 5.1 セキュリティ要件

1. **認証・認可**
   - 強力なパスワードポリシーの適用
   - 二要素認証の必須化
   - 権限ごとのアクセス制御の厳格化

2. **データ保護**
   - 個人情報へのアクセスログ記録
   - 特権操作の承認フロー
   - データマスキング（必要に応じて）

3. **監査**
   - 全ての管理操作の詳細ログ記録
   - 定期的なセキュリティ監査
   - 不正アクセス検知と通知

### 5.2 パフォーマンス要件

1. **応答性**
   - ページロード：2秒以内
   - データ操作：5秒以内
   - レポート生成：20秒以内

2. **スケーラビリティ**
   - 最大500サロン同時管理
   - サロンあたり最大50スタイリスト
   - サロンあたり最大10,000クライアント

3. **可用性**
   - 稼働率99.9%以上
   - 計画メンテナンス時間の最小化
   - 障害復旧時間の目標：2時間以内

### 5.3 互換性・連携

1. **ブラウザ対応**
   - Chrome、Firefox、Safari、Edge最新版
   - モバイルブラウザ対応（管理者向け緊急対応用）

2. **API連携**
   - RESTful API経由での管理操作
   - 監視システムとの連携
   - バックオフィスシステムとの連携

3. **データエクスポート**
   - CSV、JSON、Excel形式でのデータエクスポート
   - 定期的な自動エクスポート機能

## 6. データプライバシーと倫理的配慮

### 6.1 データアクセスポリシー

1. **目的制限**
   - SuperAdminによるデータアクセスは明確な業務目的（サポート、バグ修正、システム管理）に限定
   - 目的外アクセスを禁止する明示的ポリシーの策定

2. **最小権限の原則**
   - 必要最小限のデータへのアクセスのみを許可
   - 個人を特定できる情報へのアクセスには追加承認プロセスを導入

3. **データ分離**
   - サロン間のデータを厳格に分離
   - 複数サロンのデータ一括閲覧には特別権限を要求

### 6.2 監査と透明性

1. **アクセスログ**
   - 全てのデータアクセスを詳細に記録
   - アクセス目的の記録と定期的なレビュー
   - 異常なアクセスパターンの自動検出

2. **管理者向け透明性**
   - サロン管理者へのSuperAdminアクセス通知
   - 重要データへのアクセス履歴レポートの提供（オプション）

3. **コンプライアンス対応**
   - GDPR、個人情報保護法などの規制対応
   - データ保持ポリシーの明確化と実装
   - データ削除リクエストへの対応機能

## 7. ユーザーインターフェース要件

### 7.1 全体デザイン

1. **デザインスタイル**
   - シンプルで機能的なUI
   - 管理操作に特化した効率的なレイアウト
   - ダークモード対応（長時間作業向け）

2. **レスポンシブ対応**
   - デスクトップ最適化
   - タブレット対応（緊急時操作用）

3. **アクセシビリティ**
   - WCAG 2.1 AAレベル準拠
   - キーボードナビゲーション対応
   - スクリーンリーダー対応

### 7.2 各画面要件

1. **ダッシュボード画面**
   - 重要指標のグラフィカル表示
   - アラートと通知の優先表示
   - ドリルダウン可能なインタラクティブチャート

2. **一覧画面**
   - フィルタリングとソート機能
   - バルク操作対応
   - ページネーションとビュー切替

3. **詳細・編集画面**
   - タブ形式での情報整理
   - インラインエディット機能
   - 変更履歴表示

4. **設定画面**
   - カテゴリ別の設定整理
   - 設定変更のプレビュー機能
   - 一括設定インポート/エクスポート

## 8. 実装フェーズと優先順位

### 8.1 フェーズ1（基盤構築）

1. **コア機能**
   - 認証・認可システム
   - ダッシュボード基本機能
   - サロン一覧・詳細表示

2. **優先度高**
   - サロン作成・管理機能
   - Admin管理機能
   - ログ記録システム

### 8.2 フェーズ2（管理拡張）

1. **拡張機能**
   - サブスクリプション管理
   - 詳細なユーザー管理
   - システム設定機能

2. **優先度中**
   - レポート機能（基本）
   - バックアップ管理
   - お知らせ管理

### 8.3 フェーズ3（高度化）

1. **発展機能**
   - 高度なレポート機能
   - データ品質管理
   - API連携機能

2. **優先度低**
   - カスタムレポート
   - 予測分析
   - 高度な監視機能

## 9. 想定ユースケース

### 9.1 サロン管理

1. **新規サロン登録**
   - SuperAdminがサロン基本情報を入力
   - 管理者用初期アカウントを設定
   - サブスクリプションプランを適用
   - 招待メールを送信

2. **サロントラブル対応**
   - サロン管理者からの問い合わせ対応
   - 問題調査のためのログ確認
   - 必要に応じた設定調整
   - 問題解決の記録

### 9.2 システム監視

1. **定期チェック**
   - システム健全性の確認
   - パフォーマンス指標の監視
   - 潜在的問題の早期発見
   - 予防的メンテナンス

2. **インシデント対応**
   - アラート発生時の調査
   - 影響範囲の特定
   - 緊急対策の実施
   - 再発防止策の実装

### 9.3 データ管理

1. **データ監査**
   - 定期的なデータ整合性チェック
   - 異常なデータアクセスパターンの調査
   - コンプライアンス対応の確認

2. **データ修復**
   - 破損データの特定
   - バックアップからの復元
   - データ整合性の回復
   - 影響を受けたサロンへの報告

## 10. 技術要件

### 10.1 フロントエンド

1. **フレームワーク**
   - React.js
   - Material-UIまたはカスタムデザインシステム
   - 状態管理：Redux/Context API

2. **パフォーマンス**
   - コード分割とレイジーローディング
   - メモ化とレンダリング最適化
   - 適切なキャッシュ戦略

### 10.2 バックエンド

1. **API設計**
   - RESTful API設計
   - 厳格な認証・認可
   - レート制限と保護対策

2. **データアクセス**
   - マルチテナントデータ分離
   - 効率的なクエリ設計
   - キャッシュ戦略

### 10.3 インフラストラクチャ

1. **デプロイメント**
   - CI/CDパイプライン
   - 環境分離（開発・ステージング・本番）
   - コンテナ化とオーケストレーション

2. **セキュリティ**
   - WAFと侵入検知
   - 定期的な脆弱性スキャン
   - 暗号化（転送中・保存時）

## 11. テスト要件

### 11.1 機能テスト

1. **単体テスト**
   - コンポーネントレベルのテスト
   - APIエンドポイントテスト
   - ビジネスロジックテスト

2. **統合テスト**
   - ワークフローテスト
   - クロスサービステスト
   - エンドツーエンドテスト

### 11.2 非機能テスト

1. **パフォーマンステスト**
   - 負荷テスト
   - ストレステスト
   - 耐久性テスト

2. **セキュリティテスト**
   - 脆弱性スキャン
   - ペネトレーションテスト
   - 認証・認可テスト

## 12. 運用・保守要件

### 12.1 監視体制

1. **リアルタイム監視**
   - パフォーマンスメトリクス
   - エラーレート
   - ユーザーアクティビティ

2. **アラート設定**
   - 閾値ベースのアラート
   - 異常検知
   - エスカレーションルール

### 12.2 メンテナンス

1. **定期メンテナンス**
   - パッチ適用計画
   - データベースメンテナンス
   - パフォーマンスチューニング

2. **バージョンアップデート**
   - フィーチャーリリース計画
   - 後方互換性の確保
   - ロールバック計画

## 13. ドキュメント要件

### 13.1 運用マニュアル

1. **管理者ガイド**
   - 基本操作マニュアル
   - トラブルシューティングガイド
   - ベストプラクティス

2. **セキュリティポリシー**
   - アクセス管理ポリシー
   - インシデント対応手順
   - データ取り扱いガイドライン

### 13.2 開発者向けドキュメント

1. **アーキテクチャ文書**
   - システム構成図
   - コンポーネント説明
   - 技術スタック詳細

2. **コード関連**
   - API仕様書
   - データモデル定義
   - コーディング規約

## 14. リスクと対策

### 14.1 セキュリティリスク

1. **特権アカウント乗っ取り**
   - 対策：二要素認証の必須化、IPアドレス制限、セッション管理強化
   - 監視：異常なログインパターンの検出、特権操作の監視

2. **データ漏洩**
   - 対策：アクセス制限、暗号化、データマスキング
   - 監視：大量データアクセスの検出、データ流出監視

### 14.2 運用リスク

1. **人為的エラー**
   - 対策：操作確認ステップ、重要操作の承認フロー
   - 軽減：操作の取り消し機能、バックアップからの復元

2. **システム障害**
   - 対策：冗長構成、自動フェイルオーバー
   - 回復：障害回復手順、データバックアップ

## 15. まとめ

SuperAdmin管理サイトは美姫命サービス全体の安定運用と成長を支える重要な基盤である。セキュリティと使いやすさのバランスを取りながら、効率的なサービス管理を実現するシステムとして構築する。特に、データプライバシーと倫理的配慮は最優先事項として設計・開発を進める必要がある。

本要件定義書に基づき、詳細設計を行い、フェーズごとに機能を実装していくことで、安全で効率的なSuperAdmin管理システムを構築する。

---

## 付録A：画面一覧

1. ログイン画面
2. ダッシュボード画面（`/mockups/beauty-superadmin-dashboard.html`）
   - 全体統計
   - アラート表示
3. サロン一覧・管理画面（`/mockups/beauty-superadmin-organizations.html`）
   - 組織作成・編集機能
   - 初期管理者設定機能（統合）
   - 組織詳細・状態管理機能
4. サブスクリプション・プラン管理画面（`/mockups/beauty-superadmin-plans.html`）
   - プラン設定
   - 契約管理
5. サポートチケット管理画面（`/mockups/beauty-superadmin-support.html`）

※ beauty-superadmin-subscription.htmlは機能重複のため削除

## 付録B：権限マトリクス

### B.1 システム管理者（SuperAdmin）の権限マトリクス

| 機能カテゴリ | マスターSuperAdmin | 運用SuperAdmin | サポートSuperAdmin |
|------------|-------------------|---------------|-------------------|
| システム設定 | 作成・編集・削除       | 閲覧・一部編集     | 閲覧のみ             |
| サロン管理   | フル権限             | 作成・編集        | 閲覧のみ             |
| ユーザー管理 | フル権限             | 閲覧・編集        | 閲覧・一部編集         |
| データアクセス | 制限なし             | 限定的アクセス     | 最小限アクセス         |
| サポート機能 | フル権限             | フル権限         | フル権限             |
| 請求管理    | フル権限             | 閲覧・編集        | 閲覧のみ             |
| レポート    | フル権限             | フル権限         | 閲覧のみ             |
| 監査ログ    | フル権限             | 閲覧のみ         | アクセス不可           |

### B.2 組織内ロールの権限マトリクス

| 機能カテゴリ | Owner | Admin | User (スタイリスト) |
|------------|-------|-------|-------------------|
| 組織設定 | 作成・編集・削除 | 閲覧・一部編集 | 閲覧のみ |
| 課金・プラン管理 | フル権限 | 閲覧のみ | アクセス不可 |
| 管理者（Admin）管理 | 作成・編集・削除 | アクセス不可 | アクセス不可 |
| スタイリスト管理 | フル権限 | 作成・編集・削除 | アクセス不可 |
| クライアント管理 | フル権限 | フル権限 | 閲覧・担当クライアントのみ編集 |
| 予約管理 | フル権限 | フル権限 | 自身の予約のみ |
| データインポート | フル権限 | 実行のみ | アクセス不可 |
| カレンダー連携 | 設定・編集 | 閲覧・使用 | 閲覧・使用 |
| レポート | フル権限 | フル権限 | 限定的なレポートのみ |
| API連携設定 | フル権限 | アクセス不可 | アクセス不可 |